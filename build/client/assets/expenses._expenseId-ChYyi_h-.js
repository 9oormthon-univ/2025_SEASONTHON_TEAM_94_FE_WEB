import{r as c,j as e,w as $,f as A,g as F}from"./chunk-PVWAREVJ-DnzPyBVa.js";import{u as L}from"./ExpenseContext-dL53E0fq.js";import{c as R,a as k,B as M,E as p}from"./constants-CZolnTmg.js";function E(t,n){if(typeof t=="function")return t(n);t!=null&&(t.current=n)}function P(...t){return n=>{let a=!1;const l=t.map(r=>{const i=E(r,n);return!a&&typeof i=="function"&&(a=!0),i});if(a)return()=>{for(let r=0;r<l.length;r++){const i=l[r];typeof i=="function"?i():E(t[r],null)}}}}function W(t){const n=O(t),a=c.forwardRef((l,r)=>{const{children:i,...o}=l,u=c.Children.toArray(i),d=u.find(V);if(d){const f=d.props.children,m=u.map(h=>h===d?c.Children.count(f)>1?c.Children.only(null):c.isValidElement(f)?f.props.children:null:h);return e.jsx(n,{...o,ref:r,children:c.isValidElement(f)?c.cloneElement(f,void 0,m):null})}return e.jsx(n,{...o,ref:r,children:i})});return a.displayName=`${t}.Slot`,a}var B=W("Slot");function O(t){const n=c.forwardRef((a,l)=>{const{children:r,...i}=a;if(c.isValidElement(r)){const o=z(r),u=_(i,r.props);return r.type!==c.Fragment&&(u.ref=l?P(l,o):o),c.cloneElement(r,u)}return c.Children.count(r)>1?c.Children.only(null):null});return n.displayName=`${t}.SlotClone`,n}var T=Symbol("radix.slottable");function V(t){return c.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===T}function _(t,n){const a={...n};for(const l in n){const r=t[l],i=n[l];/^on[A-Z]/.test(l)?r&&i?a[l]=(...u)=>{const d=i(...u);return r(...u),d}:r&&(a[l]=r):l==="style"?a[l]={...r,...i}:l==="className"&&(a[l]=[r,i].filter(Boolean).join(" "))}return{...t,...a}}function z(t){var l,r;let n=(l=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:l.get,a=n&&"isReactWarning"in n&&n.isReactWarning;return a?t.ref:(n=(r=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:r.get,a=n&&"isReactWarning"in n&&n.isReactWarning,a?t.props.ref:t.props.ref||t.ref)}const U=k("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),v=c.forwardRef(({className:t,variant:n,size:a,asChild:l=!1,...r},i)=>{const o=l?B:"button";return e.jsx(o,{className:R(U({variant:n,size:a,className:t})),ref:i,...r})});v.displayName="Button";function X(t){const n=(t||"").toLowerCase();return/netflix|유튜브|youtube|디즈니|디즈니\+|구독|통신비|요금제/.test(n)?p.FIXED:/월세|관리비|전기|가스|수도|임대료/.test(n)?p.FIXED:/커피|카페|식당|편의점|gs25|cu|세븐일레븐|스타벅스|버거|치킨|피자|맥도날드|롯데리아|bhc/.test(n)?p.ADDITIONAL:p.UNCLASSIFIED}const S="w-full h-10 bg-transparent px-0 border-0 focus:outline-none focus:ring-0 focus:border-b focus:border-foreground/30 placeholder:text-muted-foreground/70",H=`${S} text-right [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none`,j="h-9 bg-transparent border-0 focus:outline-none focus:ring-0 focus:border-b focus:border-foreground/30 text-sm";function N(){const t=new Date,n=`${t.getMonth()+1}`.padStart(2,"0"),a=`${t.getDate()}`.padStart(2,"0");return`${t.getFullYear()}-${n}-${a}`}const q=$(function(){const{expenseId:n}=A(),a=F(),{expenses:l,updateExpense:r}=L(),i=l.find(s=>String(s.id)===String(n))||null,[o,u]=c.useState(i?{...i,date:i.date||N()}:null),[d,f]=c.useState(()=>i?String(Math.max(0,i.amount||0)):""),[m,h]=c.useState(()=>i?String(Math.max(1,i.sharedWith||1)):"1"),b=c.useMemo(()=>{const s=Number((d||"0").replace(/[^0-9]/g,""));return Number.isFinite(s)?Math.max(0,s):0},[d]),x=c.useMemo(()=>{const s=Number((m||"").replace(/[^0-9]/g,""));return Number.isFinite(s)&&s>=1?s:1},[m]),C=c.useMemo(()=>x<=0?0:Math.ceil(b/x),[b,x]);if(!o)return e.jsx("div",{className:"p-6 text-center text-muted-foreground",children:"항목을 찾을 수 없습니다."});const w=()=>{var g;const s={...o,amount:b,sharedWith:x,date:o.date||N(),place:((g=o.place)==null?void 0:g.trim())??"",memo:o.memo??""};try{r(s)}catch(y){console.warn("updateExpense error (ignored)",y)}finally{const y=s.category===p.UNCLASSIFIED?"unclassified":"classified";a(`/expenses?tab=${y}`)}},I=()=>{const s=o.category===p.UNCLASSIFIED?"unclassified":"classified";a(`/expenses?tab=${s}`)},D=()=>{const s=X(`${o.place} ${o.memo??""}`);u({...o,category:s})};return e.jsxs("div",{className:"page-unboxed max-w-xl mx-auto px-4 py-3 space-y-6",children:[e.jsxs("section",{children:[e.jsx("input",{type:"date",value:o.date||N(),onChange:s=>u({...o,date:s.target.value}),className:"text-xs text-muted-foreground mb-2 bg-transparent border-0 focus:outline-none focus:ring-0"}),e.jsx("input",{value:o.place,onChange:s=>u({...o,place:s.target.value}),placeholder:"상호/제목",className:`${S} text-base font-semibold`}),e.jsxs("div",{className:"mt-1 text-[12px] text-muted-foreground",children:["총 ",b.toLocaleString(),"원 · ",x,"명"]}),e.jsxs("div",{className:"flex items-end justify-between mt-4",children:[e.jsx("div",{className:"text-[11px] text-muted-foreground",children:"총 금액"}),e.jsxs("div",{className:"text-right",children:[e.jsx("input",{type:"text",inputMode:"numeric",value:d,onChange:s=>{const g=s.target.value.replace(/[^0-9]/g,"");f(g)},onBlur:()=>{d.trim()===""&&f("0")},className:`${H} text-2xl font-semibold w-44`}),x>1&&e.jsxs("div",{className:"mt-1 text-[11px] text-muted-foreground",children:["1인 ",C.toLocaleString(),"원"]})]})]})]}),e.jsxs("section",{className:"rounded-xl border bg-background overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 h-14 border-b",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"결제수단"}),e.jsxs("select",{className:`${j} pr-6`,value:o.method,onChange:s=>u({...o,method:s.target.value}),children:[e.jsx("option",{value:"현금",children:"현금"}),e.jsx("option",{value:"카드",children:"카드"}),e.jsx("option",{value:"계좌",children:"계좌"}),e.jsx("option",{value:"기타",children:"기타"})]})]}),e.jsxs("div",{className:"flex items-center justify-between px-4 h-14 border-b",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"더치 인원"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",inputMode:"numeric",className:`${j} w-20 text-right [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none`,value:m,onChange:s=>{const g=s.target.value.replace(/[^0-9]/g,"");h(g)},onBlur:()=>{(m.trim()===""||Number(m)<1)&&h("1")}}),e.jsxs(M,{variant:"secondary",className:"text-[12px] px-2 h-6",children:[x,"명 · 1인 ",C.toLocaleString(),"원"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between px-4 h-14 border-b",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"분류"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{className:`${j}`,value:o.category,onChange:s=>u({...o,category:s.target.value}),children:[e.jsx("option",{value:p.UNCLASSIFIED,children:"미분류"}),e.jsx("option",{value:p.FIXED,children:"고정"}),e.jsx("option",{value:p.ADDITIONAL,children:"추가"})]}),e.jsx(v,{variant:"outline",size:"sm",className:"h-9 px-3 text-sm",type:"button",onClick:D,children:"자동분류 재시도"})]})]}),e.jsxs("div",{className:"px-4 py-3",children:[e.jsx("div",{className:"text-sm text-muted-foreground mb-1",children:"메모"}),e.jsx("input",{value:o.memo??"",onChange:s=>u({...o,memo:s.target.value}),placeholder:"예: 친구랑 커피",className:`${S} text-sm`})]})]}),e.jsxs("section",{className:"flex justify-end gap-2",children:[e.jsx(v,{variant:"outline",size:"sm",className:"h-9 px-3 text-sm",type:"button",onClick:I,children:"취소"}),e.jsx(v,{size:"sm",className:"h-9 px-4 text-sm",type:"button",onClick:w,children:"저장"})]})]})});export{q as default};

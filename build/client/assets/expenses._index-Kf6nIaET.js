import{r as n,j as e,h as A,L as I,w as B}from"./chunk-PVWAREVJ-B6zbi7fP.js";import{M}from"./httpClient-CWcscfoA.js";import"./useExpenses-DaQT4tNd.js";import{u as F,f as R}from"./expenseApi-6HP_E5FY.js";import{E as K}from"./ExpenseHeader-DB5zjICS.js";import{M as W,i as G,u as T,P as Y,a as Z,b as q,L as J,m as v}from"./proxy-C3LYbkDo.js";import{E}from"./expense-DPxRIikd.js";class Q extends n.Component{getSnapshotBeforeUpdate(s){const i=this.props.childRef.current;if(i&&s.isPresent&&!this.props.isPresent){const d=i.offsetParent,h=G(d)&&d.offsetWidth||0,r=this.props.sizeRef.current;r.height=i.offsetHeight||0,r.width=i.offsetWidth||0,r.top=i.offsetTop,r.left=i.offsetLeft,r.right=h-r.width-r.left}return null}componentDidUpdate(){}render(){return this.props.children}}function ee({children:t,isPresent:s,anchorX:i,root:d}){const h=n.useId(),r=n.useRef(null),m=n.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:l}=n.useContext(W);return n.useInsertionEffect(()=>{const{width:f,height:c,top:p,left:x,right:a}=m.current;if(s||!r.current||!f||!c)return;const o=i==="left"?`left: ${x}`:`right: ${a}`;r.current.dataset.motionPopId=h;const u=document.createElement("style");l&&(u.nonce=l);const j=d??document.head;return j.appendChild(u),u.sheet&&u.sheet.insertRule(`
          [data-motion-pop-id="${h}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${c}px !important;
            ${o}px !important;
            top: ${p}px !important;
          }
        `),()=>{j.contains(u)&&j.removeChild(u)}},[s]),e.jsx(Q,{isPresent:s,childRef:r,sizeRef:m,children:n.cloneElement(t,{ref:r})})}const te=({children:t,initial:s,isPresent:i,onExitComplete:d,custom:h,presenceAffectsLayout:r,mode:m,anchorX:l,root:f})=>{const c=T(se),p=n.useId();let x=!0,a=n.useMemo(()=>(x=!1,{id:p,initial:s,isPresent:i,custom:h,onExitComplete:o=>{c.set(o,!0);for(const u of c.values())if(!u)return;d&&d()},register:o=>(c.set(o,!1),()=>c.delete(o))}),[i,c,d]);return r&&x&&(a={...a}),n.useMemo(()=>{c.forEach((o,u)=>c.set(u,!1))},[i]),n.useEffect(()=>{!i&&!c.size&&d&&d()},[i]),m==="popLayout"&&(t=e.jsx(ee,{isPresent:i,anchorX:l,root:f,children:t})),e.jsx(Y.Provider,{value:a,children:t})};function se(){return new Map}const w=t=>t.key||"";function O(t){const s=[];return n.Children.forEach(t,i=>{n.isValidElement(i)&&s.push(i)}),s}const S=({children:t,custom:s,initial:i=!0,onExitComplete:d,presenceAffectsLayout:h=!0,mode:r="sync",propagate:m=!1,anchorX:l="left",root:f})=>{const[c,p]=Z(m),x=n.useMemo(()=>O(t),[t]),a=m&&!c?[]:x.map(w),o=n.useRef(!0),u=n.useRef(x),j=T(()=>new Map),[X,V]=n.useState(x),[y,$]=n.useState(x);q(()=>{o.current=!1,u.current=x;for(let b=0;b<y.length;b++){const g=w(y[b]);a.includes(g)?j.delete(g):j.get(g)!==!0&&j.set(g,!1)}},[y,a.length,a.join("-")]);const P=[];if(x!==X){let b=[...x];for(let g=0;g<y.length;g++){const N=y[g],L=w(N);a.includes(L)||(b.splice(g,0,N),P.push(N))}return r==="wait"&&P.length&&(b=P),$(O(b)),V(x),null}const{forceRender:k}=n.useContext(J);return e.jsx(e.Fragment,{children:y.map(b=>{const g=w(b),N=m&&!c?!1:x===y||a.includes(g),L=()=>{if(j.has(g))j.set(g,!0);else return;let D=!0;j.forEach(z=>{z||(D=!1)}),D&&(k==null||k(),$(u.current),m&&(p==null||p()),d&&d())};return e.jsx(te,{isPresent:N,initial:!o.current||i?void 0:!1,custom:s,presenceAffectsLayout:h,mode:r,root:f,onExitComplete:N?void 0:L,anchorX:l,children:b},g)})})};function U(t){try{const s=new Date(t),i=s.getMonth()+1,d=s.getDate(),h=["일요일","월요일","화요일","수요일","목요일","금요일","토요일"][s.getDay()],r=String(s.getHours()).padStart(2,"0"),m=String(s.getMinutes()).padStart(2,"0"),l=String(s.getSeconds()).padStart(2,"0");return`${i}월 ${d}일 ${h} ${r}:${m}:${l}`}catch{return t}}const _=300;function ie({expenses:t,emptyState:s,onTransactionUpdate:i}){const[d,h]=n.useState(new Set),r=n.useCallback(async(l,f)=>{h(c=>new Set([...c,l]));try{const c=t.find(p=>p.id===l);c&&(await F(c.userUid,l,{price:c.price,title:c.title,type:f,category:c.category}),setTimeout(()=>{i==null||i(l,f)},_))}catch(c){console.error("Transaction update failed:",c),h(p=>{const x=new Set(p);return x.delete(l),x})}},[t,i]);if(t.length===0&&s)return e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:s.icon}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s.title}),e.jsx("p",{className:"text-gray-500 text-sm",children:s.description})]});if(t.length===0)return e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"📝"}),e.jsx("p",{className:"text-gray-500 text-base",children:"미분류 항목이 없습니다."})]});const m=t.filter(l=>!d.has(l.id));return e.jsx("div",{className:"space-y-6 pb-32",children:e.jsx(S,{mode:"popLayout",children:m.map(l=>e.jsx(v.div,{layout:!0,initial:{opacity:1,y:0},exit:{opacity:0,x:-100,transition:{duration:_/1e3,ease:"easeInOut"}},transition:{layout:{duration:_/1e3,ease:"easeInOut"}},children:e.jsx(ne,{expense:l,onUpdate:r})},l.id))})})}function ne({expense:t,onUpdate:s}){const i=t.title.split(" ")[0]||"은행",d=r=>{r.preventDefault(),s(t.id,"FIXED_EXPENSE")},h=r=>{r.preventDefault(),s(t.id,"OVER_EXPENSE")};return e.jsxs("div",{className:"w-full flex flex-col gap-2",children:[e.jsxs("div",{className:"bg-white rounded-[10px] p-4 mb-1.5 flex flex-col",children:[e.jsx("div",{className:"text-[12px] text-[#101010] mb-1 font-medium",children:U(t.startedAt)}),e.jsxs("div",{className:"text-base text-[#101010] mb-3 font-medium",children:[e.jsx("span",{className:"text-black",children:i}),e.jsx("span",{className:"text-[#bfbfbf] ml-1",children:"에서 온 알림"})]}),e.jsxs("div",{className:"text-2xl font-medium 'text-black'}",children:["- ",t.price.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"flex space-x-1.5",children:[e.jsx("div",{onClick:d,className:"flex-1 h-[45px] bg-white border border-[#ff6200] rounded-[10px] flex items-center justify-center",children:e.jsx("span",{className:"text-[16px] font-bold text-[#ff6200]",children:"고정지출"})}),e.jsx("div",{onClick:h,className:"flex-1 h-[45px] bg-[#ff6200] rounded-[10px] flex items-center justify-center",children:e.jsx("span",{className:"text-[16px] font-bold text-[#fffefb]",children:"초과지출"})})]})]})}function ae({expenses:t,emptyState:s,onExpenseUpdate:i}){const[d,h]=n.useState(!1),[r,m]=n.useState(!1);if(t.length===0&&s)return e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:s.icon}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s.title}),e.jsx("p",{className:"text-gray-500 text-sm",children:s.description})]});if(t.length===0)return e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"📊"}),e.jsx("p",{className:"text-gray-500 text-base",children:"분류된 항목이 없습니다."})]});const l=t.filter(a=>a.type===E.OVER_EXPENSE),f=t.filter(a=>a.type===E.FIXED_EXPENSE),c=l.reduce((a,o)=>a+o.price,0),p=f.reduce((a,o)=>a+o.price,0),x=3;return e.jsxs("div",{className:"pb-32",children:[l.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsx(H,{title:"초과지출",subtitle:"이제 차근차근 줄여보세요!",total:c,count:l.length}),e.jsxs("div",{className:"space-y-3 mt-6",children:[l.slice(0,x).map(a=>e.jsx(C,{expense:a,onUpdate:i},a.id)),e.jsx(S,{children:d&&l.slice(x).map((a,o)=>e.jsx(v.div,{initial:{opacity:0,height:0,y:-10},animate:{opacity:1,height:"auto",y:0},exit:{opacity:0,height:0,y:-10},transition:{duration:.3,delay:o*.05,ease:"easeOut"},style:{overflow:"hidden"},children:e.jsx("div",{children:e.jsx(C,{expense:a,onUpdate:i})})},a.id))})]}),l.length>x&&e.jsx("div",{className:"text-center mt-4",children:e.jsx(v.div,{onClick:()=>h(!d),className:"text-[#8e8e8e] text-[13px] tracking-[-0.26px] hover:text-[#6b6b6b] transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:400,damping:17},children:d?"접기":"더보기"})})]}),f.length>0&&e.jsxs("div",{children:[e.jsx(H,{title:"고정지출",total:p,count:f.length}),e.jsxs("div",{className:"space-y-6 mt-6",children:[f.slice(0,x).map(a=>e.jsx(C,{expense:a,onUpdate:i},a.id)),e.jsx(S,{children:r&&f.slice(x).map((a,o)=>e.jsx(v.div,{initial:{opacity:0,height:0,y:-10},animate:{opacity:1,height:"auto",y:0},exit:{opacity:0,height:0,y:-10},transition:{duration:.3,delay:o*.05,ease:"easeOut"},style:{overflow:"hidden"},children:e.jsx("div",{children:e.jsx(C,{expense:a,onUpdate:i})})},a.id))})]}),f.length>x&&e.jsx("div",{className:"text-center mt-4",children:e.jsx(v.div,{onClick:()=>m(!r),className:"text-[#8e8e8e] text-[13px] tracking-[-0.26px] hover:text-[#6b6b6b] transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},transition:{type:"spring",stiffness:400,damping:17},children:r?"접기":"더보기"})})]})]})}function H({title:t,subtitle:s,total:i,count:d}){return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("div",{className:"text-[24px] font-bold text-[#002b5b]",children:t}),s&&e.jsx("div",{className:"text-[15px] text-[#1e1e1e]",children:s}),e.jsxs("div",{className:"text-[24px] font-bold text-[#ff6200]",children:["- ",i.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"flex items-center text-[13px] text-[#8e8e8e] tracking-[-0.26px] my-2",children:[e.jsx("span",{children:"8월 1일 - 8월 28일"}),e.jsx("span",{className:"mx-2",children:"·"}),e.jsxs("span",{children:[d,"회 지출"]})]})]})}function C({expense:t,onUpdate:s}){const i=t.title.split(" ")[0]||"은행";return e.jsx("div",{className:"flex flex-col gap-1",children:e.jsxs("div",{className:"bg-white rounded-[10px] p-4 flex flex-col",children:[e.jsx("div",{className:"text-[12px] text-[#101010] mb-1 font-medium",children:U(t.startedAt)}),e.jsxs("div",{className:"text-base text-[#101010] mb-3 font-medium",children:[e.jsx("span",{className:"text-black",children:i}),e.jsx("span",{className:"text-[#bfbfbf] ml-1",children:"에서 온 알림"})]}),e.jsxs("div",{className:"text-2xl font-medium 'text-black'}",children:["- ",t.price.toLocaleString(),"원"]})]})})}const re=t=>n.createElement("svg",{width:11,height:7,viewBox:"0 0 11 7",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},n.createElement("path",{d:"M5.5 7L0 1.32432L1.28333 0L5.5 4.35135L9.71667 0L11 1.32432L5.5 7Z",fill:"#757575"})),le=t=>n.createElement("svg",{width:35,height:35,viewBox:"0 0 35 35",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},n.createElement("rect",{x:.5,y:.5,width:34,height:34,rx:17,fill:"white",stroke:"#002B5B"}),n.createElement("path",{d:"M10 18.608V17.104H16.56V10H18.192V17.104H24.72V18.608H18.192V25.712H16.56V18.608H10Z",fill:"#002B5B"}));function ce(){const[t]=A(),s=t.get("tab")||"unclassified",[i,d]=n.useState("8월 1일 - 8월 28일"),[h,r]=n.useState([]),[m,l]=n.useState(!1),[f,c]=n.useState(null),p=async()=>{try{l(!0),c(null);let o=[];if(s==="unclassified")o=await R({userUid:M,type:E.NONE});else{const[u,j]=await Promise.all([R({userUid:M,type:E.OVER_EXPENSE}),R({userUid:M,type:E.FIXED_EXPENSE})]);o=[...u,...j]}r(o)}catch(o){c(o instanceof Error?o.message:"지출 데이터를 불러오는데 실패했습니다.")}finally{l(!1)}};n.useEffect(()=>{p()},[s]);const x=n.useCallback(o=>{r(u=>u.filter(j=>j.id!==o))},[]);if(f)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"bg-white rounded-lg border border-red-200 p-6 max-w-md",children:e.jsxs("div",{className:"text-red-600 text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"⚠️"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"오류가 발생했습니다"}),e.jsx("p",{className:"text-sm mb-4",children:f}),e.jsx("button",{onClick:p,className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700",children:"다시 시도"})]})})});const a=()=>s==="unclassified"?e.jsx(ie,{expenses:h,emptyState:{icon:"🎉",title:"미분류 지출이 없어요!",description:"모든 지출이 분류되었습니다."},onTransactionUpdate:x}):e.jsx(ae,{expenses:h,emptyState:{icon:"📝",title:"분류된 지출이 없어요",description:"지출을 추가하고 분류해보세요."},onExpenseUpdate:p});return e.jsxs("div",{className:"min-h-screen bg-[rgba(235,235,235,0.35)] relative max-w-md mx-auto",children:[e.jsx(K,{}),e.jsx("div",{className:"bg-white h-[60px]",children:e.jsxs("div",{className:"flex items-center justify-between px-6",children:[e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"relative",children:[e.jsx(I,{to:"/expenses?tab=unclassified",className:`py-2 text-2xl font-bold transition-colors duration-200 ${s==="unclassified"?"text-[#002b5b]":"text-[#bfbfbf]"}`,children:"미분류"}),s==="unclassified"&&e.jsx(v.div,{layoutId:"tabIndicator",className:"absolute -bottom-2 left-0 right-0 h-1 bg-[#002b5b]",initial:{opacity:0},animate:{opacity:1},transition:{type:"spring",stiffness:500,damping:30}})]}),e.jsxs("div",{className:"relative ml-6",children:[e.jsx(I,{to:"/expenses?tab=classified",className:`py-2 text-2xl font-bold transition-colors duration-200 ${s==="classified"?"text-[#002b5b]":"text-[#bfbfbf]"}`,children:"분류"}),s==="classified"&&e.jsx(v.div,{layoutId:"tabIndicator",className:"absolute -bottom-2 left-0 right-0 h-1 bg-[#002b5b]",initial:{opacity:0},animate:{opacity:1},transition:{type:"spring",stiffness:500,damping:30}})]})]}),e.jsx(I,{to:"/expenses/add",children:e.jsx(le,{className:"w-9 h-9"})})]})}),e.jsxs("div",{className:"text-sm text-[#757575] px-6 pt-4 pb-2 flex items-center",children:[i,e.jsx(re,{className:"w-3 h-3 ml-2"})]}),e.jsx("div",{className:"px-6 pt-2",children:m?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#ff6200]"})}):e.jsx(S,{mode:"wait",children:e.jsx(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3,ease:[.4,0,.2,1]},children:a()},s)})})]})}const ue=B(function(){return e.jsx(ce,{})});export{ue as default};

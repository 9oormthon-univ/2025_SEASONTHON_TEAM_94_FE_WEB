var _=Object.defineProperty;var w=(s,t,e)=>t in s?_(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var d=(s,t,e)=>w(s,typeof t!="symbol"?t+"":t,e);function f(){return"https://api.stopusing.klr.kr"}const p={TIMEOUT:1e4,RETRY_COUNT:3},u={TOKEN_KEY:"stopusing_auth_token",REFRESH_TOKEN_KEY:"stopusing_refresh_token",TOKEN_EXPIRY_KEY:"stopusing_token_expiry"},Y="a",v={TRANSACTIONS:"/api/v1/transactions",TRANSACTION_BY_ID:s=>`/api/v1/transactions/${s}`,TRANSACTIONS_REPORT:"/api/v1/transactions/report",CATEGORIES:"/api/v1/transactions/categories",BUDGET_GOALS:"/api/v1/budgetgoals",BUDGET_GOAL_BY_ID:s=>`/api/v1/budgetgoals/${s}`,USERS_ME:"/api/v1/users/me",AUTH_LOGOUT:"/api/logout"},I=p.TIMEOUT,O=p.RETRY_COUNT,R=1e3;class h extends Error{constructor(t,e,r,o){super(t),this.status=e,this.response=r,this.responseBody=o,this.name="HttpError"}}class l extends Error{constructor(t,e){super(t),this.originalError=e,this.name="NetworkError"}}class S extends Error{constructor(t="요청이 시간 초과되었습니다"){super(t),this.name="TimeoutError"}}async function y(s){return new Promise(t=>setTimeout(t,s))}function g(s,t,e){return t>=e?!1:s instanceof l||s instanceof h&&s.status>=500}function A(){return typeof window>"u"}class N{constructor(){d(this,"headerInterceptor");this.setHeaderInterceptor(()=>{const t={};if(typeof window<"u"){const e=localStorage.getItem(u.TOKEN_KEY)||sessionStorage.getItem(u.TOKEN_KEY);e&&(t.Authorization=`Bearer ${e}`)}return t})}setHeaderInterceptor(t){this.headerInterceptor=t}clearAuthData(){typeof window<"u"&&(localStorage.removeItem(u.TOKEN_KEY),localStorage.removeItem(u.REFRESH_TOKEN_KEY),localStorage.removeItem(u.TOKEN_EXPIRY_KEY),sessionStorage.removeItem(u.TOKEN_KEY))}createUrl(t,e){let r;t.startsWith("http")||t.startsWith("/")?r=t:r=`/api/v1/${t}`;let o;if(A()){const a=f();if(!a)throw new Error("API Base URL이 설정되지 않았습니다");o=t.startsWith("http")?t:`${a}${r}`}else t.startsWith("http")?o=t:o=`${f()}${r}`;if(e){const a=new URL(o);return Object.entries(e).forEach(([n,i])=>{i!=null&&a.searchParams.append(n,String(i))}),a.toString()}return o}getHeaders(t){var o;const e={"Content-Type":"application/json"},r=((o=this.headerInterceptor)==null?void 0:o.call(this))||{};return{...e,...r,...t}}async handleResponse(t){if(!t.ok){t.status===401&&(this.clearAuthData(),typeof window<"u"&&(window.location.href="/login"));let e;try{e=await t.json()}catch{try{e=await t.text()}catch{e=null}}const r=`HTTP ${t.status}: ${t.statusText}`;throw new h(r,t.status,t,e)}try{return await t.json()}catch(e){throw e instanceof h?e:new h("응답 파싱 중 오류가 발생했습니다",t.status,t)}}async request(t,e={}){const r=e.retries??O,o=e.timeout??I;let a;for(let n=0;n<=r;n++){const i=new AbortController,T=setTimeout(()=>i.abort(),o);try{const E={method:e.method||"GET",headers:this.getHeaders(e.headers),signal:i.signal};e.body!==void 0&&(E.body=JSON.stringify(e.body));const c=this.createUrl(t,e.params),m=await fetch(c,E);return clearTimeout(T),await this.handleResponse(m)}catch(E){clearTimeout(T);const c=this.processError(E);if(a=c,g(c,n,r)){console.warn(`HTTP 요청 실패, 재시도 중... (${n+1}/${r})`,{endpoint:t,error:c.message}),await y(R*Math.pow(2,n));continue}throw c}}throw a}processError(t){return t instanceof Error?t.name==="AbortError"?new S:t instanceof h?t:new l("네트워크 오류가 발생했습니다",t):new l("알 수 없는 오류가 발생했습니다")}async get(t,e,r){return this.request(t,{...r,method:"GET",params:e})}async post(t,e,r){return this.request(t,{...r,method:"POST",body:e})}async put(t,e,r){return this.request(t,{...r,method:"PUT",body:e})}async patch(t,e,r){return this.request(t,{...r,method:"PATCH",body:e})}async delete(t,e){return this.request(t,{...e,method:"DELETE"})}}const U=new N,H=U;export{v as A,Y as M,H as h};
